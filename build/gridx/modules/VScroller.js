//>>built
define("gridx/modules/VScroller","dojo/_base/declare dojo/_base/Deferred dojo/_base/event dojo/_base/sniff dojo/query dojo/dom-geometry dojo/keys dojox/html/metrics ../core/_Module".split(" "),function(v,p,t,k,w,l,m,u,x){return v(x,{name:"vScroller",forced:["view","body","vLayout","columnWidth"],optional:["pagination"],constructor:function(){var b=this.grid,d=this.domNode=b.vScrollerNode;this.stubNode=d.firstChild;if(b.autoHeight)d.style.display="none",8>k("ie")&&(d.style.width="0px");else{var a=
u.getScrollbar().w,b=b.isLeftToRight();d.style.width=a+"px";d.style[b?"right":"left"]=-a+"px";8>k("ie")&&(this.stubNode.style.width=a+1+"px")}},preload:function(b){this.grid.hLayout.register(null,this.domNode,1)},load:function(b,d){var a=this,e=a.grid,h=e.body,c=a.domNode,f=e.bodyNode;a.batchConnect([a.domNode,"onscroll","_doScroll"],[f,"onmousewheel","_onMouseWheel"],[e.mainNode,"onkeypress","_onKeyScroll"],k("ff")&&[f,"DOMMouseScroll","_onMouseWheel"]);a.aspect(e,"_onResizeEnd","_onBodyChange");
a.aspect(h,"onForcedScroll","_onForcedScroll");a.aspect(h,"onRender","_onBodyChange");e.autoHeight||a.aspect(h,"onEmpty",function(){var b=c.style;b.display="none";b.width="";8>k("ie")&&(b.width=a.stubNode.style.width="0px");e.hLayout.reLayout();e.hScroller.refresh()});d.then(function(){a._updatePos();p.when(a._init(b),function(){a.domNode.style.width="";a.loaded.callback()})})},scrollToRow:function(b,d){var a=new p,e=this.grid.bodyNode,h=this.domNode,c=0,f=w('[visualindex\x3d"'+b+'"]',e)[0],r=function(b){setTimeout(function(){a.callback(b)},
5)};if(f){var c=f.offsetTop,q=e.scrollTop;if(d)return h.scrollTop=c,r(!0),a;if(c<q)c-=q;else if(c+f.offsetHeight>q+e.clientHeight)c=c+f.offsetHeight-q-e.clientHeight;else return r(!0),a;h.scrollTop+=c}r(!!f);return a},_init:function(){return this._onForcedScroll()},_update:function(){var b=this.grid;if(!b.autoHeight){var d=b.bodyNode,d=d.scrollHeight>d.clientHeight,a=this.domNode.style;scrollBarWidth=u.getScrollbar().w+(k("webkit")?1:0);if(8>k("ie")){var e=d?scrollBarWidth+2+"px":"0px";this.stubNode.style.width=
e;a.width=e}else a.width="";a.display=d?"":"none";this._updatePos()}b.hLayout.reLayout()},_updatePos:function(){var b=this.grid,d=this.domNode,a=d.style,e=b.isLeftToRight(),b=l.getBorderExtents(b.mainNode);a[e?"right":"left"]=-(d.offsetWidth+(e?b.r:b.l))+"px"},_doScroll:function(){this.grid.bodyNode.scrollTop=this.domNode.scrollTop},_onMouseWheel:function(b){"none"!=this.grid.vScrollerNode.style.display&&(this.domNode.scrollTop-="number"===typeof b.wheelDelta?b.wheelDelta/3:-40*b.detail,t.stop(b))},
_onBodyChange:function(){var b=this,d=b.grid;b._update();setTimeout(function(){d.bodyNode&&(b.stubNode.style.height=d.bodyNode.scrollHeight+"px",b._doScroll(),d.vScrollerNode.scrollTop=d.vScrollerNode.scrollTop||0)},0)},_onForcedScroll:function(){var b=this.grid.view,d=this.grid.body;return this.model.when({start:b.rootStart,count:b.rootCount},function(){d.renderRows(0,b.visualCount)})},_onKeyScroll:function(b){var d=this.grid,a=d.body,e=d.bodyNode,h=d.focus,c=this.domNode,f;if(e.childNodes.length&&
(!h||"body"==h.currentArea())){if(b.keyCode==m.HOME&&b.ctrlKey)c.scrollTop=0,f=e.firstChild,a._focusCellCol=0;else if(b.keyCode==m.END&&b.ctrlKey)c.scrollTop=c.scrollHeight-c.offsetHeight,f=e.lastChild,a._focusCellCol=d._columns.length-1;else if(b.keyCode==m.PAGE_UP)c.scrollTop?c.scrollTop-=c.offsetHeight:f=e.firstChild;else if(b.keyCode==m.PAGE_DOWN)c.scrollTop>=c.scrollHeight-c.offsetHeight?f=e.lastChild:c.scrollTop+=c.offsetHeight;else return;h&&(f?(a._focusCellRow=parseInt(f.getAttribute("visualindex"),
10),h.focusArea("body",1)):setTimeout(function(){for(var d=e.childNodes,c=0,k=d.length-1,g=l.position(e),n,s,p=function(a){var c=d[a];a=l.position(c);if(b.keyCode==m.PAGE_DOWN)return c=c.previousSibling,!c&&a.y>=g.y||a.y==g.y?0:c?(a=l.position(c),a.y<g.y&&a.y+a.h>=g.y?0:a.y>g.y?1:-1):-1;c=c.nextSibling;return!c&&a.y+a.h<=g.y+g.h||a.y+a.h==g.y+g.h?0:c?(a=l.position(c),a.y<=g.y+g.h&&a.y+a.h>g.y+g.h?0:a.y>g.y+g.h?1:-1):1};c<=k;)if(n=Math.floor((c+k)/2),s=p(n),0>s)c=n+1;else if(0<s)k=n-1;else{f=d[n];
break}f&&(a._focusCellRow=parseInt(f.getAttribute("visualindex"),10),h.focusArea("body",1))},0));t.stop(b)}}})});
//@ sourceMappingURL=VScroller.js.map