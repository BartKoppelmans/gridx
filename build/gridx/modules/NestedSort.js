//>>built
define("gridx/modules/NestedSort","dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/event dojo/query dojo/string dojo/dom-class dojo/dom-construct dojo/keys ../core/_Module ../core/model/extensions/Sort dojo/i18n!../nls/NestedSort ./HeaderRegions".split(" "),function(u,p,k,v,l,r,s,w,x,y,z,d){var m=p.filter,t=p.indexOf,q=s.remove,f=s.add;return u(y,{name:"sort",required:["headerRegions"],modelExtensions:[z],preload:function(c){var a=this;c=a.grid;a._sortData=a.arg("initialOrder",[]);
if(c.persist){var b=c.persist.registerAndLoad("sort",function(){return a._sortData});b&&(a._sortData=b)}a._sortData=m(a._sortData,function(b){return a.isSortable(b.colId)});a._sortData.length&&c.model.sort(a._sortData);a.connect(c.headerRegions,"refresh",a._updateUI);c.headerRegions.add(k.hitch(a,a._createBtn,1),10,1);c.headerRegions.add(k.hitch(a,a._createBtn,0),11,1)},columnMixin:{isSorted:function(){return this.grid.sort.isSorted(this.id)},isSortable:function(){return this.grid.sort.isSortable(this.id)}},
getSortData:function(){return this._sortData},sort:function(c){var a=this;a._sortData=m(c,function(b){return a.isSortable(b.colId)});a._doSort()},isSorted:function(c){var a=0;p.some(this._sortData,function(b){if(b.colId==c)return a=b.descending?-1:1,1});return a},isSortable:function(c){return(c=this.grid._columnsById[c])&&(c.sortable||void 0===c.sortable)},clear:function(){this._sortData.length=0;this._doSort()},_createBtn:function(c,a){var b=this;if(b.isSortable(a.id)){var e=w.create("div",{"class":"gridxSortBtn gridxSortBtn"+
(c?"Single":"Nested"),tabIndex:-1,title:c?d.singleSort+" - "+d.ascending:d.nestedSort+" - "+d.ascending,innerHTML:c?'\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#1784;\x3c/span\x3e\x26nbsp;':b._sortData.length+1+'\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#1784;\x3c/span\x3e'});b.connect(e,"onmousedown",function(){b._sort(a,e,c)});b.connect(e,"onkeydown",function(d){d.keyCode==x.ENTER&&(v.stop(d),b._sort(a,e,c))});return e}},_sort:function(c,a,b){a=this._sortData;b?(1<a.length&&(a.length=
0),b=m(a,function(a){return a.colId===c.id})[0],a.length=0,b&&a.push(b)):b=m(a,function(a){return a.colId===c.id})[0];b?(b.descending&&a.splice(t(a,b),1),b.descending=!b.descending):(b={colId:c.id,descending:!1},a.push(b));this._doSort()},_doSort:function(){var c=this.grid,a=this._sortData;this._updateUI();c.model.sort(a.length?a:null);c.body.refresh()},_updateUI:function(){var c=this,a=c.grid,b=a.domNode,e=c._sortData;q(b,"gridxSingleSorted");q(b,"gridxNestedSorted");1==e.length?f(b,"gridxSingleSorted"):
1<e.length&&f(b,"gridxNestedSorted");l(".gridxCell",a.header.domNode).forEach(function(a){var b=a.getAttribute("colid");if(c.isSortable(b)){p.forEach(["","Desc","Asc","Main"],function(b){q(a,"gridxCellSorted"+b)});var h=l(".gridxSortBtnSingle",a)[0],g=l(".gridxSortBtnNested",a)[0];h.title=d.singleSort+" - "+d.ascending;g.title=d.nestedSort+" - "+d.ascending;h.innerHTML='\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#1784;\x3c/span\x3e\x26nbsp;';g.innerHTML=e.length+1+'\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#1784;\x3c/span\x3e';
var n=m(e,function(a){return a.colId===b})[0];c._setWaiState(a,b,n);if(n){g.innerHTML=t(e,n)+1;f(a,"gridxCellSorted");n==e[0]&&f(a,"gridxCellSortedMain");var k=e.length;n.descending?(f(a,"gridxCellSortedDesc"),1==k?(h.title=d.singleSort+" - "+d.unsorted,h.innerHTML='\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#9662;\x3c/span\x3e\x26nbsp;'):(g.title=d.nestedSort+" - "+d.unsorted,g.innerHTML+='\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#9662;\x3c/span\x3e')):(f(a,"gridxCellSortedAsc"),
1==k?(h.title=d.singleSort+": "+d.descending,h.innerHTML='\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#9652;\x3c/span\x3e\x26nbsp;'):(g.title=d.nestedSort+" - "+d.descending,g.innerHTML+='\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#9652;\x3c/span\x3e'))}}})},_setWaiState:function(c,a,b){a="Column "+this.grid.column(a).name();var e="none",f="ascending";b&&(e=b.descending?"descending":"ascending",f=b.descending?"none":"descending");b=r.substitute(d.waiSingleSortLabel,[a,e,f]);a=r.substitute(d.waiNestedSortLabel,
[a,e,f]);l(".gridxSortBtnSingle",c)[0].setAttribute("aria-label",b);l(".gridxSortBtnNested",c)[0].setAttribute("aria-label",a)}})});
//@ sourceMappingURL=NestedSort.js.map