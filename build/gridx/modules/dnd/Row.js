//>>built
define("gridx/modules/dnd/Row","dojo/_base/declare dojo/_base/array dojo/_base/Deferred dojo/_base/lang dojo/dom-class dojo/dom-geometry dojo/_base/sniff ./_Base ../../core/_Module".split(" "),function(w,q,m,u,x,n,y,z,B){function A(a,f){if(a.grid){var b=new m,c=r(b,b.callback),d=r(b,b.errback),g=[],h=a.grid,k=h.dnd.row._selectedRowIds;h.model.when({id:k},function(){s(k,function(a){h.model.idToIndex(a);(a=h.model.byId(a))&&g.push(u.clone(a.rawData))})}).then(function(){c(g)},d);return b}return a.getGridDndRowData&&
a.getGridDndRowData(f)||[]}var r=u.hitch,s=q.forEach;return w(z,{name:"dndRow",required:["_dnd","moveRow"],getAPIPath:function(){return{dnd:{row:this}}},accept:["grid/rows"],provide:["grid/rows"],onDraggedOut:function(a){var f=[];if(a.grid)f=a.grid.dnd._dnd.profile.arg("accept");else for(var b in a.accept)f.push(b);if(!this.checkArg("copyWhenDragOut",f)){a=this.grid;var c=a.model,d=a.store,g=this._selectedRowIds;if(d.fetch){var h=[];a.model.when({id:g},function(){s(g,function(a){(a=c.byId(a))&&h.push(a.item)})}).then(function(){s(h,
d.deleteItem,d);d.save()})}else s(g,d.remove,d)}},_checkDndReady:function(a){var f=this.model;return!f.getMark||f.getMark(a.rowId)?(this.grid.dnd._dnd.profile=this,this._selectedRowIds=f.getMarkedIds?f.getMarkedIds():[a.rowId],!0):!1},_cssName:"Row",_onBeginDnd:function(a){a.delay=this.arg("delay")},_getDndCount:function(){return this._selectedRowIds.length},_onEndDnd:function(){},_buildDndNodes:function(){var a=this.grid.id;return q.map(this._selectedRowIds,function(f){return["\x3cdiv id\x3d'",a,
"_dndrow_",f,"' gridid\x3d'",a,"' rowid\x3d'",f,"'\x3e\x3c/div\x3e"].join("")}).join("")},_onBeginAutoScroll:function(){var a=this.grid.autoScroll;this._autoScrollH=a.horizontal;a.horizontal=!1},_onEndAutoScroll:function(){this.grid.autoScroll.horizontal=this._autoScrollH},_getItemData:function(a){return a.substring((this.grid.id+"_dndrow_").length)},_calcTargetAnchorPos:function(a,f){var b=this,c=a.target,d=b.grid.view,g={width:f.w+"px",height:"",left:""},h=function(a){return b.model.getMark&&b.model.getMark(a.getAttribute("rowid"))},
k=function(a){return parseInt(a.getAttribute("visualindex"),10)},p=function(c){var d=c,e=d,l=d;if(h(d)){for(e=d.previousSibling;e&&h(e);)d=e,e=e.previousSibling;e=d;d=c;for(l=d.nextSibling;l&&h(l);)d=l,l=l.nextSibling;l=d}e&&l?(d=n.position(e),c=n.position(l),a.clientY<(d.y+c.y+c.h)/2?(b._target=k(e),g.top=d.y-f.y+"px"):(b._target=k(l)+1,g.top=c.y+c.h-f.y+"px")):delete b._target;return g};if(!y("ff"))for(;c;){if(x.contains(c,"gridxRow"))return p(c);c=c.parentNode}var t=b.grid.bodyNode,v=t.childNodes;
if(v.length){var c=t.firstChild,m=k(c),e=n.position(c);if(0===m&&a.clientY<=e.y+e.h)g.top=e.y-f.y+"px",b._target=0;else if(c=t.lastChild,m=k(c),e=n.position(c),m===d.visualCount-1&&a.clientY>e.y+e.h)g.top=e.y+e.h-f.y+"px",b._target=d.visualCount;else return q.some(v,function(b){e=n.position(b);if(e.y<=a.clientY&&e.y+e.h>=a.clientY)return c=b,!0})?p(c):null}else g.top="0px",b._target=0;return g},_onDropInternal:function(a,f){var b=this,c=b.grid;0<=b._target&&b.model.when({id:b._selectedRowIds},function(){var a=
q.map(b._selectedRowIds,function(a){return b.model.idToIndex(a)});c.move.row.move(a,c.view.getRowInfo({visualIndex:b._target}).rowIndex)})},_onDropExternal:function(a,f,b){b=new m;var c=r(b,b.callback),d=r(b,b.errback),g=this.grid,h=this._target,k,p,n=A(a,f);g.model.when([h-1,h],function(){k=g.model.byIndex(h);p=g.model.byIndex(h-1)}).then(function(){m.when(n,function(a){a&&a.length&&(a=g.model.insert(a,p&&p.item,k&&k.item),m.when(a,c,d))},d)},d);return b}})});
//@ sourceMappingURL=Row.js.map