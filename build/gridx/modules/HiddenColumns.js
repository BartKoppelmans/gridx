//>>built
define("gridx/modules/HiddenColumns",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/array","dojo/query","../core/_Module"],function(l,m,f,k,n){return l(n,{name:"hiddenColumns",load:function(a,e){var d=this,b=d.grid,c=d.arg("init",[]);d._cols=b._columns.slice();b.move&&b.move.column&&d.connect(b.move.column,"onMoved","_syncOrder");b.persist&&(c=c.concat(b.persist.registerAndLoad("hiddenColumns",function(){return d.get()})||[]));c.length?e.then(function(){d.add.apply(d,c);d.loaded.callback()}):
d.loaded.callback()},add:function(){var a=this.grid,e=a._columnsById,d=a._columns,b=a.columnLock,c=0,g=f.filter(f.map(arguments,function(a){a=a&&"object"==typeof a?a.id:a;return e[a]}),function(a){return a&&!a.ignore&&(void 0===a.hidable||a.hidable)});b&&(c=b.count,b.unlock());f.forEach(g,function(b){b.index<c&&--c;b.hidden=!0;delete e[b.id];d.splice(f.indexOf(d,b),1);k('[colid\x3d"'+a._escapeId(b.id)+'"].gridxCell',a.domNode).forEach(function(a){a.parentNode.removeChild(a)})});g.length&&f.forEach(d,
function(a,b){a.index=b});a.columnWidth._adaptWidth();k(".gridxCell",a.bodyNode).forEach(function(a){var b=a.style;b.width=b.minWidth=b.maxWidth=e[a.getAttribute("colid")].width});if(a.vScroller._doVirtualScroll)a.body.onForcedScroll();return this._refresh(0).then(function(){b&&0<c&&b.lock(c)})},remove:function(){var a=this,e=a.grid,d=e._columns,b=e.columnLock,c=0,g;b&&(c=b.count,b.unlock());f.forEach(arguments,function(b){b=b&&"object"==typeof b?b.id:b;for(var c,e=-1,h=0,f=a._cols.length;h<f;++h)if(c=
a._cols[h],c.id==b&&c.hidden){delete c.hidden;c.index=++e;break}else c.hidden||(e=c.index);if(h<f){g=1;a.grid._columnsById[b]=c;d.splice(e,0,c);for(h=e+1;h<d.length;++h)d[h].index=h}});return a._refresh(g).then(function(){b&&0<c&&b.lock(c)})},clear:function(){var a=this.grid,e=a.columnLock,d=0,b;e&&(d=e.count,e.unlock());a._columns=f.map(this._cols,function(c,d){c.index=d;c.hidden&&(b=1,delete c.hidden,a._columnsById[c.id]=c);return c});return this._refresh(b).then(function(){e&&0<d&&e.lock(d)})},
get:function(){for(var a=[],e=this._cols,d=0;d<e.length;++d)e[d].hidden&&a.push(e[d].id);return a},_syncOrder:function(){for(var a=this._cols,e=this.grid._columns,d=0,b=0,c,g;d<e.length&&b<a.length;++d,++b){for(c=a[b];c.hidden;c=a[b])++b;e[d]!=c&&(g=f.indexOf(a,e[d]),a[b]=a[g],a[g]=c)}},_refresh:function(a){if(a)return a=this.grid,a.header.refresh(),a.columnWidth._adaptWidth(),a.body.refresh();a=new m;a.callback();return a}})});
//@ sourceMappingURL=HiddenColumns.js.map