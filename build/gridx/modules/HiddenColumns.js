//>>built
define("gridx/modules/HiddenColumns",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/array","dojo/query","../core/_Module"],function(n,p,g,m,q){return n(q,{name:"hiddenColumns",load:function(a,c){var d=this,b=d.grid,e=d.arg("init",[]);d._cols=b._columns.slice();d.aspect(b,"setColumns",function(){d._cols=b._columns.slice()});b.move&&b.move.column&&d.connect(b.move.column,"onMoved","_syncOrder");b.persist&&(e=e.concat(b.persist.registerAndLoad("hiddenColumns",function(){return d.get()})||[]));
e.length?c.then(function(){d.add.apply(d,e);d.loaded.callback()}):d.loaded.callback()},add:function(){for(var a=this.grid,c=a._columnsById,d=a._columns,b=a.columnLock,e=0,h={},k=g.filter(g.map(arguments,function(a){a=a&&"object"==typeof a?a.id:a;return c[a]}),function(a){return a&&!a.ignore&&(void 0===a.hidable||a.hidable)}),l=0,r=k.length;l<r;++l)h[k[l].id]=k[l];var k=[],f;for(f in h)k.push(h[f]);b&&(e=b.count,b.unlock());g.forEach(k,function(b){b.index<e&&--e;b.hidden=!0;delete c[b.id];d.splice(g.indexOf(d,
b),1);m('[colid\x3d"'+a._escapeId(b.id)+'"].gridxCell',a.domNode).forEach(function(a){a.parentNode.removeChild(a)})});k.length&&g.forEach(d,function(a,b){a.index=b});a.columnWidth._adaptWidth();m(".gridxCell",a.bodyNode).forEach(function(a){var b=a.style;b.width=b.minWidth=b.maxWidth=c[a.getAttribute("colid")].width});if(a.vScroller._doVirtualScroll)a.body.onForcedScroll();return this._refresh(0).then(function(){b&&0<e&&b.lock(e)})},remove:function(){var a=this,c=a.grid,d=c._columns,b=c.columnLock,
e=0,h;b&&(e=b.count,b.unlock());g.forEach(arguments,function(b){b=b&&"object"==typeof b?b.id:b;for(var c,e=-1,f=0,g=a._cols.length;f<g;++f)if(c=a._cols[f],c.id==b&&c.hidden){delete c.hidden;c.index=++e;break}else c.hidden||(e=c.index);if(f<g){h=1;a.grid._columnsById[b]=c;d.splice(e,0,c);for(f=e+1;f<d.length;++f)d[f].index=f}});return a._refresh(h).then(function(){b&&0<e&&b.lock(e)})},clear:function(){var a=this.grid,c=a.columnLock,d=0,b;c&&(d=c.count,c.unlock());a._columns=g.map(this._cols,function(c,
d){c.index=d;c.hidden&&(b=1,delete c.hidden,a._columnsById[c.id]=c);return c});return this._refresh(b).then(function(){c&&0<d&&c.lock(d)})},get:function(){for(var a=[],c=this._cols,d=0;d<c.length;++d)c[d].hidden&&a.push(c[d].id);return a},_syncOrder:function(){for(var a=this._cols,c=this.grid._columns,d=0,b=0,e,h;d<c.length&&b<a.length;++d,++b){for(e=a[b];e.hidden;e=a[b])++b;c[d]!=e&&(h=g.indexOf(a,c[d]),a[b]=a[h],a[h]=e)}},_refresh:function(a){var c=this.grid;if(a)return c.header.refresh(),c.columnWidth._adaptWidth(),
c.body.refresh();a=new p;c.header.onRender();a.callback();return a}})});
//@ sourceMappingURL=HiddenColumns.js.map