//>>built
define("gridx/modules/ColumnLock","dojo/dom-style dojo/dom-class dojo/dom-geometry dojo/_base/lang ../core/_Module dojo/_base/declare dojo/_base/array dojo/_base/window dojo/query dojo/_base/sniff".split(" "),function(k,h,n,p,q,r,f,s,t,u){return r(q,{name:"columnLock",required:["body"],count:0,load:function(a,d){this.count=this.arg("count");var c=this,b=this.grid;s.body();d.then(function(){if(!b.columnWidth||!b.columnWidth.arg("autoResize"))c.connect(b.body,"onAfterRow",function(b){c._lockColumns(b.node())}),
c.connect(b.columnWidth,"onUpdate","_updateHeader"),b.columnResizer&&(c.connect(b.columnResizer,"onResize","_updateHeader"),c.connect(b.columnResizer,"onResize","_updateBody")),b.header&&(b.header.loaded.then(function(){c._updateHeader()}),b.move&&b.move.column&&c.connect(b.move.column,"move","_updateHeader")),c._hackHScroller(),c.count&&c.lock(c.count);c.loaded.callback()})},lock:function(a){if(!this.grid.columnWidth||!this.grid.columnWidth.arg("autoResize"))a>=this.grid._columns.length?(this.count=
0,console.warn("Warning: lock count is larger than columns count, do nothing.")):(this.unlock(),a&&h.add(this.grid.domNode,"gridxColumnLock"),this.count=a,this._updateUI())},unlock:function(){if(!this.grid.columnWidth||!this.grid.columnWidth.arg("autoResize")){h.remove(this.grid.domNode,"gridxColumnLock");var a=t(".gridxHeaderRowInner",this.grid.headerNode)[0];this._unlockColumns(a);f.forEach(this.grid.bodyNode.childNodes,this._unlockColumns,this);this.count=0;this._updateUI()}},_unlockColumns:function(a){for(var d=
this.grid.isLeftToRight(),c=a.firstChild.rows[0],b=0;b<this.count;b++){var e=c.cells[b];h.remove(e,"gridxLockedCell");k.set(e,{height:"auto"})}a.style[d?"paddingLeft":"paddingRight"]="0px";a.style.width="auto"},_updateUI:function(){this.grid.header&&this._updateHeader();this._updateBody();this._updateScroller();this.grid.hScroller&&this.grid.hScroller._doScroll();this.grid.header.onRender()},_lockColumns:function(a){if(!this.count||this.count>=this.grid._columns.length)this.count=0;else{var d=h.contains(a,
"gridxHeaderRowInner"),c=this.grid.isLeftToRight(),b=a.firstChild.rows[0],e;for(e=0;e<this.count;e++)k.set(b.cells[e],"height","auto");var f=n.getContentBox(b.cells[b.cells.length-1]).h;e=n.getMarginBox(b.cells[b.cells.length-1]).h;var g=window.getComputedStyle(a.firstChild,null).getPropertyValue("height");8<u("ie")&&0<=g.toString().indexOf(".")&&(e++,f++);k.set(a.firstChild,"height",e+"px");g=d=d?this.grid.hLayout.lead:0;for(e=0;e<this.count;e++){var l=b.cells[e],m;h.add(l,"gridxLockedCell");m={height:f+
"px"};m[c?"left":"right"]=g+"px";k.set(l,m);g+=l.offsetWidth}a.style[c?"paddingLeft":"paddingRight"]=g-d+"px";a.style.width=this.grid.bodyNode.offsetWidth-g+d+"px";a.scrollLeft=this.grid.hScroller?this.grid.hScroller.domNode.scrollLeft:0}},_updateHeader:function(){var a=this.grid.header.innerNode,d=a.scrollLeft;this._lockColumns(a);a.scrollLeft=d;this._updateScroller()},_updateBody:function(){f.forEach(this.grid.bodyNode.childNodes,this._lockColumns,this)},_updateScroller:function(){this.grid.hScroller&&
this.grid.hScroller.refresh()},_hackHScroller:function(){var a=this;p.mixin(this.grid.hScroller,{_doScroll:function(){var d=this.domNode.scrollLeft;a.count?f.forEach(this.grid.bodyNode.childNodes,function(a){a.scrollLeft=d;if("absolute"==a.style.position){var b=0;f.forEach(a.firstChild.rows[0].cells,function(a){h.contains(a,"gridxLockedCell")&&(a.style.left=d+b+"px",b+=a.offsetWidth)})}}):this.grid.bodyNode.scrollLeft=d;this.grid.onHScroll(this.grid.hScroller._lastLeft)}})}})});
//@ sourceMappingURL=ColumnLock.js.map