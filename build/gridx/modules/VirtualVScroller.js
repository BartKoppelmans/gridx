//>>built
define("gridx/modules/VirtualVScroller","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/sniff dojo/_base/event dojo/_base/Deferred dojo/query dojo/keys ./VScroller ../core/_Module".split(" "),function(E,z,y,A,B,F,C,u,D,G){return E(D,{constructor:function(b,a){b.autoHeight?z.mixin(this,new D(b,a)):this._scrolls=[]},destroy:function(){this.inherited(arguments);clearTimeout(this._lazyScrollHandle);clearTimeout(this._pVirtual)},buffSize:5,lazy:!1,lazyTimeout:50,scrollToRow:function(b,
a){var e=new F,d=this,c=d._scrolls,f=function(){d._subScrollToRow(b,e,a)};c.push(e);d._lazy=d.arg("lazy");d.lazy=!1;1<c.length?c[c.length-2].then(f):f();return e},_subScrollToRow:function(b,a,e){var d=this,c=0,f=d._avgRowHeight,g=d.grid.bodyNode,k=d.domNode,c=g.scrollTop,p=k.scrollTop,l=g.clientHeight,m=C('[visualindex\x3d"'+b+'"]',g)[0],v=d.grid.focus,q=function(c){c&&!m.getAttribute("rowid")?a.scrollContext=[b,a,e]:(d._scrolls.splice(y.indexOf(d._scrolls,a),1),v&&"body"==v.currentArea()&&v.focusArea("body",
1),d.lazy=d._lazy,setTimeout(function(){a.callback(c)},5))};if(m)if(f=m.offsetTop,m.offsetHeight>=l){if(f==c){q(!0);return}c=f-c}else if(f+m.offsetHeight>c+l)c=f-c,e||(c+=m.offsetHeight-l);else if(f<c||e&&f>c)c=f-c;else{q(!0);return}else if(g.childNodes.length){for(var h=g.firstChild;h&&h.offsetTop<c;)h=h.nextSibling;var s=h&&h.getAttribute("visualindex");if(h&&b<s)c=(b-s)*f;else{for(h=g.lastChild;h&&h.offsetTop+h.offsetHeight>c+l&&h!=g.firstChild;)h=h.previousSibling;s=h&&h.getAttribute("visualindex");
if(h&&b>s)c=(b-s)*f;else{q(!1);return}}}else{q(!1);return}l=0===p&&0>c;p=p>=k.scrollHeight-k.offsetHeight&&0<c;if(l||p)d._doVirtualScroll(1);else if(f=k.scrollTop,c=f+(c>g.offsetHeight?c/d._ratio:c),c>k.scrollHeight&&(c=k.scrollHeight),k.scrollTop=c,k.scrollTop==f){q(!1);return}l&&0==g.firstChild.getAttribute("visualindex")||p&&g.lastChild.getAttribute("visualindex")==d.grid.view.visualCount-1?q(!1):setTimeout(function(){d._subScrollToRow(b,a,e)},5)},_init:function(b){var a=this;a._rowHeight={};a._syncHeight();
a.connect(a.grid,"_onResizeEnd",function(){a._doScroll(0,1)});a._doScroll(0,1,1)},_doVirtualScroll:function(b){var a=this.domNode,e=a.scrollTop,d=e-(this._lastScrollTop||0);if(b||d){this._lastScrollTop=e;var c=this.arg("buffSize");b=a.scrollHeight-a.offsetHeight;var f=this.grid.body,g=0+this.grid.view.visualCount,k=this.grid.bodyNode,p=k.firstChild,l=p&&p.offsetTop-d,m=k.lastChild,v=m&&m.offsetTop-d+m.offsetHeight,q=k.scrollTop,h=q+k.clientHeight,s=this._avgRowHeight,u=Math.ceil(a.offsetHeight/s)+
2*c,w=this._ratio,a=2>=e,x=2>=Math.abs(e-b),n,r,t;if(q==h&&!h)return;p&&l>q&&l<h?(r=f.renderStart,t=Math.ceil((l-q)*w/s)+c,n=a?0:Math.max(r-t,0),t="top"):m&&v>q&&v<h?(n=f.renderStart+f.renderCount,t=Math.ceil((h-v)*w/s)+c,r=x&&e?g:Math.min(n+t,g),t="bottom"):!p||l>h||!m||v<q?(e<=b/2?(n=a?0:0+Math.max(Math.floor(e*w/s)-c,0),r=Math.min(n+u,g)):(r=x?g:g+Math.min(u-Math.floor((b-e)*w/s),0),n=Math.max(r-u,0)),t="clear"):p&&(a?(g=f.renderStart,0<g&&(n=0,r=g,t="top")):x&&(c=f.renderStart+f.renderCount-1,
c<g-1&&(n=c+1,r=g,t="bottom")));"number"==typeof n&&"number"==typeof r&&(f.renderRows(n,r-n,t),e&&n<r&&(n=C('[visualindex\x3d"'+r+'"]',k)[0])&&(d+=n.offsetTop));a?k.scrollTop=0:x||e>b?k.scrollTop=k.scrollHeight:"clear"!=t&&(k.scrollTop+=d)}this._doVirtual()},_doScroll:function(b,a,e){!e&&this.arg("lazy")?(this._lazyScrollHandle&&clearTimeout(this._lazyScrollHandle),this._lazyScrollHandle=setTimeout(z.hitch(this,this._doVirtualScroll,a),this.arg("lazyTimeout"))):this._doVirtualScroll(a)},_onMouseWheel:function(b){"none"!=
this.grid.vScrollerNode.style.display&&(this.domNode.scrollTop-="number"===typeof b.wheelDelta?b.wheelDelta/3:-40*b.detail,B.stop(b))},_onBodyChange:function(){var b=this;b._update();b._doScroll(0,1);y.forEach(b._scrolls,function(a){if(a.scrollContext){var e=a.scrollContext;delete a.scrollContext;b._subScrollToRow.apply(b,e)}})},_onForcedScroll:function(){this._rowHeight={};this._doScroll(0,1)},_avgRowHeight:24,_rowHeight:null,_ratio:1,_syncHeight:function(){var b=this._avgRowHeight*this.grid.view.visualCount,
a=1342177;A("ff")?a=17895697:A("webkit")&&(a=134217726);b>a&&(this._ratio=b/a,b=a);var a=this.domNode,e=a.scrollTop/a.scrollHeight;this.stubNode.style.height=b+"px";this._lastScrollTop&&(this._lastScrollTop=a.scrollTop=a.scrollHeight*e)},_doVirtual:function(){var b=this;clearTimeout(b._pVirtual);b._pVirtual=setTimeout(function(){b._updateRowHeight()},100)},_updateRowHeight:function(b){var a=0,e=0,d=this.grid,c=d.body,d=d.bodyNode,f=this.buffSize*this._avgRowHeight,g=d.scrollTop,k=g-f,p=g+d.clientHeight+
f,l=this._rowHeight,f=0;y.forEach(d.childNodes,function(b){l[b.getAttribute("rowid")]=b.offsetHeight;b.offsetTop>p?++e:b.offsetTop+b.offsetHeight<k&&++a});"post"!=b&&(c.unrenderRows(a),f=a);"pre"!=b&&(c.unrenderRows(e,"post"),f=e);var m,c=b=0;for(m in l)b+=l[m],++c;c&&(this._avgRowHeight=b/c,this._syncHeight());return f},_onKeyScroll:function(b){var a=this.grid.body,e=this.grid.view,d=this.grid.focus,c=this.domNode;if(!d||"body"==d.currentArea()){if(b.keyCode==u.HOME&&b.ctrlKey)a._focusCellCol=0,
a._focusCellRow=0,c.scrollTop=0,a._focusCell();else if(b.keyCode==u.END&&b.ctrlKey)a._focusCellCol=this.grid._columns.length-1,a._focusCellRow=e.visualCount-1,c.scrollTop=this.stubNode.clientHeight-a.domNode.offsetHeight,a._focusCell();else if(b.keyCode==u.PAGE_UP)a=a._focusCellRow=Math.max(a.renderStart-a.renderCount,0),this.scrollToRow(a);else if(b.keyCode==u.PAGE_DOWN)a=a._focusCellRow=Math.min(e.visualCount-1,a.renderStart+a.renderCount),this.scrollToRow(a,1);else return;B.stop(b)}}})});
//@ sourceMappingURL=VirtualVScroller.js.map