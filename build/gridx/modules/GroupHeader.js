//>>built
define("gridx/modules/GroupHeader","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/sniff dojo/dom-class dojo/keys dojo/query ./Header".split(" "),function(v,w,q,x,s,r,n,g,y){v.experimental("gridx/modules/GroupHeader");return w(y,{preload:function(b){this.inherited(arguments);var a=this.grid,c=a._escapeId;a.columnResizer&&this.aspect(a.columnResizer,"onResize",function(b){var e=g('[colid\x3d"'+c(b)+'"]',a.headerNode)[0].offsetWidth-a.columnWidth._padBorder+"px";e!=
a._columnsById[b].width&&g('[colid\x3d"'+c(b)+'"]',a.domNode).forEach(function(a){a=a.style;a.width=e;a.minWidth=e;a.maxWidth=e})})},refresh:function(){this.inherited(arguments);this._curNode=0},_parse:function(){var b=this.grid._columns,a=b.length,c=0,f=0,e=this.arg("groups",[]),z=this._groupsById={},l=function(e,p,g){q.isArrayLike(e)||(e=[e]);p>f&&(f=p);for(var h=0,k=0;k<e.length;){var d=e[k];if(c>=a)e.splice(k,1);else if("number"==typeof d&&0<d){c+d>a&&(d=e[k]=a-c);for(var m=0;m<d;++m)b[c+m].groupId=
g;h+=d;c+=d;++k}else d&&q.isObject(d)?(q.isArrayLike(d.children)||(d.children=[d.children]),d.groupId=g,d.id=d.id||"group-"+p+"-"+b[c].id,d.level=p,d.start=c,m=l(d.children,p+1,d.id),d.children.length?(z[d.id]=d,d.colCount=m,h+=m,++k):e.splice(k,1)):e.splice(k,1)}return h};l(e,0);c<a&&e.push(a-c);return f},_configMoveColumn:function(){var b=this.grid;if(b.move&&b.move.column){var a=b.move.column.arg("constraints",{}),c;for(c in this._groupsById){var f=this._groupsById[c],e=f.start+f.colCount-1;if("number"!=
typeof a[f.start]||e<a[f.start])a[f.start]=e}var g=-1,l=0;x.forEach(b._columns,function(b,c){b.groupId||(c!=g+1&&(l=c),g=c,a[l]=c)})}},_build:function(){var b=this.grid,a=b.focus,c=b._columns.slice(),f=0,e=this._parse(),g=this.groups.slice(),l=['\x3ctable role\x3d"presentation" border\x3d"0" cellpadding\x3d"0" cellspacing\x3d"0"\x3e'];for(this._configMoveColumn();g.length;){l.push("\x3ctr\x3e");for(var n=0,p=0,s=g.length;p<s;++p){var h=g.shift();if("number"==typeof h){for(var k=0;k<h;++k){var d=c[n+
k],m=d.headerClass,t=d.headerStyle,u=d.width;d._domId=(b.id+"-"+d.id).replace(/\s+/,"");l.push('\x3ctd role\x3d"columnheader" aria-readonly\x3d"true" tabindex\x3d"-1" id\x3d"',d._domId,'" colid\x3d"',d.id,e-f?'" rowspan\x3d"'+(e-f+1):"",'" class\x3d"gridxCell ',f?"gridxSubHeader":"",a&&"header"==a.currentArea()&&d.id==this._focusHeaderId?this._focusClass:"",(m&&q.isFunction(m)?m(d):m)||"",'" style\x3d"width:',u,";min-width:",u,";max-width:",u,";",b.getTextDirStyle(d.id,d.name),(t&&q.isFunction(t)?
t(d):t)||"",'"\x3e\x3cdiv class\x3d"gridxSortNode"\x3e',d.name||"","\x3c/div\x3e\x3c/td\x3e")}c.splice(n,h)}else n+=h.colCount,g=g.concat(h.children),l.push('\x3ctd tabindex\x3d"-1" colspan\x3d"',h.colCount,'" class\x3d"gridxGroupHeader',f?" gridxSubHeader":"",'" groupid\x3d"',h.id,'"\x3e\x3cdiv class\x3d"gridxSortNode"\x3e',h.name||"","\x3c/div\x3e\x3c/td\x3e")}l.push("\x3c/tr\x3e");f++}l.push("\x3c/table\x3e");this.innerNode.innerHTML=l.join("");r.toggle(this.domNode,"gridxHeaderRowHidden",this.arg("hidden"));
r.add(b.domNode,"gridxGH")},_initFocus:function(){var b=this,a=b.grid;a.focus&&a.focus.registerArea({name:"header",priority:0,focusNode:b.innerNode,scope:b,doFocus:b._doFocus,doBlur:b._blurNode,onBlur:b._blurNode,connects:[b.connect(b.domNode,"onkeydown","_onKeyDown"),b.connect(b.domNode,"onmousedown",function(c){b._focusNode(g(c.target).closest("td",b.domNode)[0]);a.focus.currentArea()})]})},_doFocus:function(b,a){var c=this._curNode||g("td",this.domNode)[0];this._focusNode(c);return c},_focusNode:function(b){if(b){var a=
this,c=a.grid,f=a._focusHeaderId=b.getAttribute("colid");if(!f){var f=a._focusGroupId=b.getAttribute("groupid"),e=a._groupsById[f];e&&(f=c._columns[b.offsetLeft+b.offsetWidth>a.innerNode.scrollLeft+a.innerNode.clientWidth?e.start+e.colCount-1:e.start].id)}if(f&&c._columnsById[f])return a._blurNode(),c.hScroller&&c.hScroller.scrollToColumn(f),c.body._focusCellCol=c._columnsById[f].index,a._curNode=b,r.add(b,a._focusClass),setTimeout(function(){s("webkit")&&r.add(b,a._focusClass);b.focus();8>s("ie")&&
(a.innerNode.scrollLeft=a._scrollLeft)},0),!0}return!1},_blurNode:function(){var b=g("."+this._focusClass,this.innerNode)[0];b&&r.remove(b,this._focusClass);return!0},_getUpNode:function(b){var a=b.getAttribute("colid");b=b.getAttribute("groupid");return(a=this.grid._columnsById[a]||this._groupsById[b])&&g('[groupid\x3d"'+a.groupId+'"]',this.domNode)[0]},_getDownNode:function(b,a){var c=this._groupsById[b.getAttribute("groupid")];if(c){var f=c.children[0];if("number"==typeof f)return this.getHeaderNode(this.grid._columns[c.start].id);
c=g('[groupid\x3d"'+f.id+'"]',this.domNode);return a?c[c.length-1]:c[0]}},_getPrevNode:function(b){var a=b.previousSibling;a||(a=(a=(a=this._getUpNode(b))&&this._getPrevNode(a))&&this._getDownNode(a,1)||a);return a},_getNextNode:function(b){var a=b.nextSibling;a||(a=(a=(a=this._getUpNode(b))&&this._getNextNode(a))&&this._getDownNode(a)||a);return a},_onKeyDown:function(b){var a=this.grid,c=this._curNode;if(!a._isCtrlKey(b)&&!b.altKey&&(b.keyCode==n.LEFT_ARROW||b.keyCode==n.RIGHT_ARROW)){if(a.focus.stopEvent(b),
a=a.isLeftToRight()^b.keyCode==n.RIGHT_ARROW?this._getPrevNode(c):this._getNextNode(c))if(this._focusHeaderId=a.getAttribute("colid"),this._focusGroupId=a.getAttribute("groupid"),this._focusNode(a),this._focusHeaderId)this.onMoveToHeaderCell(this._focusHeaderId,b)}else b.keyCode==n.UP_ARROW?(a.focus.stopEvent(b),this._focusNode(this._getUpNode(c))):b.keyCode==n.DOWN_ARROW&&(a.focus.stopEvent(b),this._focusNode(this._getDownNode(c)))}})});
//@ sourceMappingURL=GroupHeader.js.map