//>>built
define("gridx/modules/Dod","dojo/_base/kernel dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-geometry dojo/_base/lang dojo/_base/Deferred ../core/_Module dojo/_base/declare dojo/_base/fx dojo/fx dojo/query".split(" "),function(q,h,d,k,l,m,r,s,t,n,p,g){q.experimental("gridx/modules/Dod");return t(s,{name:"dod",required:["body"],useAnimation:!0,duration:750,defaultShow:!1,showExpando:!0,load:function(a,b){this._rowMap={};this.connect(this.grid.body,"onAfterCell","_onAfterCell");this.connect(this.grid.body,
"onAfterRow","_onAfterRow");this.connect(this.grid.bodyNode,"onclick","_onBodyClick");this.connect(this.grid.body,"onUnrender","_onBodyUnrender");this.grid.columnResizer&&this.connect(this.grid.columnResizer,"onResize","_onColumnResize");this.loaded.callback()},rowMixin:{showDetail:function(){this.grid.dod.show(this)},hideDetail:function(){this.grid.dod.hide(this)},toggleDetail:function(){this.grid.dod.toggle(this)},refreshDetail:function(){this.grid.dod.refreshDetail(this)},isDetailShown:function(){return this.grid.dod.isShown(this)}},
show:function(a){var b=this._row(a);if(!b.dodShown&&!b.inAnim&&a.node()){b.dodShown=!0;var c=this._getExpando(a);c&&(c.firstChild.innerHTML="-");var c=a.node(),e=c.scrollWidth;b.dodLoadingNode||(b.dodLoadingNode=h.create("div",{className:"gridxDodLoadNode",innerHTML:"Loading..."}));b.dodNode||(b.dodNode=h.create("div",{className:"gridxDodNode"}));h.place(b.dodLoadingNode,c,"last");h.place(b.dodNode,c,"last");d.set(b.dodLoadingNode,"width",e+"px");d.set(b.dodNode,"width",e+"px");k.add(c,"gridxDodShown");
d.set(b.dodNode,"display","none");b.dodLoaded?this._detailLoadComplete(a):(d.set(b.dodLoadingNode,"display","block"),this.grid.rowHeader&&(c=g('[rowid\x3d"'+this.grid._escapeId(a.id)+'"].gridxRowHeaderRow',this.grid.rowHeader.bodyNode)[0],d.set(c.firstChild,"height",d.get(a.node(),"height")+"px")),c=new r,this.arg("detailProvider")?this.detailProvider(this.grid,a.id,b.dodNode,c):c.callback(),c.then(m.hitch(this,"_detailLoadComplete",a),m.hitch(this,"_detailLoadError",a)))}},hide:function(a){var b=
this._row(a),c=this.grid,e=c._escapeId;if(b.dodShown&&!b.inAnim&&a.node()){k.remove(a.node(),"gridxDodShown");d.set(b.dodLoadingNode,"display","none");if(this.grid.rowHeader){var f=g('[rowid\x3d"'+e(a.id)+'"].gridxRowHeaderRow',this.grid.rowHeader.bodyNode)[0];d.set(f.firstChild,"height",d.get(a.node(),"height")-1+"px")}if(f=this._getExpando(a))f.firstChild.innerHTML="+";this.arg("useAnimation")?(b.inAnim=!0,p.wipeOut({node:b.dodNode,duration:this.arg("duration"),onEnd:function(){b.dodShown=!1;b.inAnim=
!1;c.body.onRender()}}).play(),this.grid.rowHeader&&(f=g('[rowid\x3d"'+e(a.id)+'"].gridxRowHeaderRow',this.grid.rowHeader.bodyNode)[0],n.animateProperty({node:f.firstChild,duration:this.arg("duration"),properties:{height:{start:f.offsetHeight,end:f.offsetHeight-b.dodNode.scrollHeight,units:"px"}}}).play())):(b.dodShown=!1,b.inAnim=!1,b.dodNode.style.display="none",c.body.onRender(),this.grid.rowHeader&&(f=g('[rowid\x3d"'+e(a.id)+'"].gridxRowHeaderRow',this.grid.rowHeader.bodyNode)[0],f.firstChild.style.height=
f.offsetHeight-b.dodNode.scrollHeight+"px"));b.defaultShow=!1}},toggle:function(a){this.isShown(a)?this.hide(a):this.show(a)},refresh:function(a){this._row(a).dodLoaded=!1;this.show(a)},isShown:function(a){return!!this._row(a).dodShown},onShow:function(a){},onHide:function(a){},_rowMap:null,_lastOpen:null,_row:function(a){var b=a;"object"===typeof a&&(b=a.id);return this._rowMap[b]||(this._rowMap[b]={})},_onBodyClick:function(a){if(k.contains(a.target,"gridxDodExpando")||k.contains(a.target,"gridxDodExpandoText")){for(a=
a.target;a&&!k.contains(a,"gridxRow");)a=a.parentNode;a=a.getAttribute("rowindex");this.toggle(this.grid.row(parseInt(a)))}},_onAfterRow:function(a){var b=this._row(a);if(this.arg("showExpando")){var c=g("table",a.node())[0].rows[0].cells[0];h.create("span",{className:"gridxDodExpando",innerHTML:'\x3cspan class\x3d"gridxDodExpandoText"\x3e'+(this.arg("defaultShow")?"-":"+")+"\x3c/span\x3e"},c,"first")}if(this.isShown(a)||this.arg("defaultShow")&&void 0===b.dodShown)b.dodShown=!1,b.defaultShow=!0,
this.show(a)},_onBodyUnrender:function(a){if(a&&(a=this._row(a))){var b=a.dodNode;b&&b.parentNode&&b.parentNode.removeChild(b);(a=a.dodLoadingNode)&&a.parentNode&&a.parentNode.removeChild(a)}},_onAfterCell:function(a){this.arg("showExpando")&&0==a.node().cellIndex&&this._onAfterRow(a.row)},_onColumnResize:function(){g(".gridxDodNode",this.grid.bodyNode).forEach(function(a){d.set(a,"width",a.parentNode.firstChild.offsetWidth+"px")})},_detailLoadComplete:function(a){var b=this._row(a),c=this.grid,e=
c._escapeId;this.isShown(a)&&(b.dodLoaded=!0,b.defaultShow?(d.set(b.dodNode,"display","block"),c.body.onRender()):("block"==d.get(b.dodLoadingNode,"display")&&(l.setMarginBox(b.dodNode,{h:l.getMarginBox(b.dodLoadingNode).h}),d.set(b.dodNode,"display","block")),this.arg("useAnimation")?(b.inAnim=!0,p.wipeIn({node:b.dodNode,duration:this.arg("duration"),onEnd:function(){b.inAnim=!1;c.body.onRender()}}).play(),this.grid.rowHeader&&(e=g('[rowid\x3d"'+e(a.id)+'"].gridxRowHeaderRow',this.grid.rowHeader.bodyNode)[0],
n.animateProperty({node:e.firstChild,duration:this.arg("duration"),properties:{height:{start:e.offsetHeight,end:a.node().firstChild.offsetHeight+b.dodNode.scrollHeight,units:"px"}}}).play())):(b.dodNode.style.display="block",b.dodNode.style.height="auto",c.body.onRender(),this.grid.rowHeader&&(e=g('[rowid\x3d"'+e(a.id)+'"].gridxRowHeaderRow',this.grid.rowHeader.bodyNode)[0],e.firstChild.style.height=a.node().firstChild.offsetHeight+b.dodNode.scrollHeight+"px"))),d.set(b.dodLoadingNode,"display","none"))},
_detailLoadError:function(a){var b=this._row(a);b.dodLoaded=!1;this.isShown(a)&&(b.dodLoadingNode.innerHTML="Error: failed to load detail.")},_showLoading:function(a){this._row(a).dodLoadingNode.innerHTML="Loading..."},_getExpando:function(a){return!this.showExpando?null:g("table",a.node())[0].rows[0].cells[0].firstChild},endFunc:function(){}})});
//@ sourceMappingURL=Dod.js.map