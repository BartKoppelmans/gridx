//>>built
define("gridx/modules/ExpandableColumn","dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/event dojo/keys dojo/aspect dojo/query dojo/string dojo/dom-class dojo/dom-construct ../core/_Module ./HiddenColumns".split(" "),function(m,g,q,n,r,s,h,t,f,l,u,p,v,w){return m(p,{name:"expandedColumn",_parentCols:null,required:["header"],preload:function(){this.inherited(arguments)},load:function(a,d){var b=this,e=b.grid;b._cols=e._columns.slice();b._parentCols={};var k=[];g.forEach(b._cols,function(c){if(c.expanded)k.push(c.id);
else if(c.parentColumn){b._parentCols[c.parentColumn]=1;var a=this._colById(c.parentColumn);a.expanded||(k.push(c.id),a.expanded=!1)}},this);this.expandoBar=l.create("div",{className:"gridxColumnExpandoBar"});this.connect(e.columnWidth,"onUpdate","_updateUI");this.grid.vLayout.register(this,"expandoBar","headerNode",1);this.connect(e,"onHeaderCellMouseOver",function(c){f.add(this._expandoCellByColumnId(c.columnId),"gridxColumnExpandoHighlight")},this);this.connect(e,"onHeaderCellMouseOut",function(c){f.remove(this._expandoCellByColumnId(c.columnId),
"gridxColumnExpandoHighlight")},this);this.connect(this.expandoBar,"onmouseover",function(c){var a=null;/td/i.test(c.target.tagName)?a=c.target:f.contains(c.target,"gridxColumnExpando")&&(a=c.target.parentNode);a&&(c=a.getAttribute("data-column-id"),f.add(a,"gridxColumnExpandoHighlight"),f.add(this._headerCellByColumnId(c),"gridxCellHighlight"))},this);this.connect(this.expandoBar,"onmouseout",function(c){var a=null;/td/i.test(c.target.tagName)?a=c.target:f.contains(c.target,"gridxColumnExpando")&&
(a=c.target.parentNode);a&&(c=a.getAttribute("data-column-id"),f.remove(a,"gridxColumnExpandoHighlight"),f.remove(this._headerCellByColumnId(c),"gridxCellHighlight"))},this);this.connect(this.expandBar,"onclick",function(a){f.contains(a.target,"gridxColumnExpando")&&(a=a.target.parentNode.getAttribute("data-column-id"),this.expand(a))},this);this.connect(this.grid.header.innerNode,"onkeyup",function(a){if(77==a.keyCode&&a.ctrlKey){var b=a.target;f.contains(b,"gridxGroupHeader")?(b=b.getAttribute("groupid").split("-").pop(),
b=this._colById(b).parentColumn,this.collapse(b),this._focusById(b)):f.contains(b,"gridxCell")&&(b=b.getAttribute("colid"),this._parentCols[b]&&(this.expand(b),this._focusById(b)));n.stop(a)}},this);this.connect(this.grid.header,"refresh",function(){e.header.hidden?(e.header.domNode.parentNode.style.overflow="hidden",this.expandoBar.style.display="none"):(e.header.domNode.parentNode.style.overflow="visible",this.expandoBar.style.display="block")});this.connect(this.grid,"onHScroll",function(a){this.expandoBar.scrollLeft=
a},this);k.length?d.then(function(){b.add.apply(b,k);b._refreshHeader();b.loaded.callback()}):b.loaded.callback()},expand:function(a){var d=g.filter(this._cols,function(b){return b.parentColumn==a});this.add(a);this.remove.apply(this,d);this._colById(a).expanded=!0;this._refreshHeader()},collapse:function(a){var d=g.filter(this._cols,function(b){return b.parentColumn==a});this.remove(a);this.add.apply(this,d);this._colById(a).expanded=!1;this._refreshHeader()},_updateUI:function(){var a=['\x3ctable role\x3d"presentation" border\x3d"0" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\x3ctr\x3e'];
g.forEach(this.grid._columns,function(d){a.push('\x3ctd data-column-id\x3d"',d.id,'" aria-readonly\x3d"true" tabindex\x3d"-1" class\x3d"gridxColumnExpandoCell"\x3e');this._parentCols[d.id]&&a.push('\x3cspan class\x3d"gridxColumnExpando"\x3e\x3c/span\x3e');a.push("\x3c/td\x3e")},this);a.push("\x3c/tr\x3e\x3c/table\x3e");this.expandoBar.innerHTML=a.join("");this.grid._columns.length&&(this.expandoBar.style.marginRight=this.grid.header.innerNode.style.marginRight,this.expandoBar.style.marginLeft=this.grid.header.innerNode.style.marginLeft,
h("table",this.grid.headerNode),g.forEach(this.expandoBar.firstChild.rows[0].cells,function(a,b){var e=a.getAttribute("data-column-id"),e=this.grid._columnsById[e];a.style.width=e.width;a.style.minWidth=e.width;a.style.maxWidth=e.width},this))},_createExpandNode:function(a,d){var b=l.create("div",{innerHTML:"",className:"gridxColumnExpandNode"});if(this._parentCols[d.id]){b.innerHTML='\x3cspan class\x3d"gridxColumnExpandNodeIcon"\x3e\x3c/span\x3e';var e=this;b.onclick=function(){e.expand(d.id)}}else b.innerHTML=
"";return b},_headerCellByColumnId:function(a){var d=h('td[colid\x3d"'+a+'"]',this.grid.headerNode)[0];d||(d=h('td[data-map-column-id\x3d"'+a+'"]',this.grid.headerNode)[0]);return d},_expandoCellByColumnId:function(a){return h('td[data-column-id\x3d"'+a+'"]',this.expandoBar)[0]},_refreshHeader:function(){for(var a=[],d=this.grid._columns,b=null,e=0,f=0;f<d.length;f++){var c=d[f];if(c.parentColumn){0<e&&(a.push(e),e=0);if(!b||b._colId!=c.parentColumn)b&&b._colId!=c.parentColumn&&a.push(b),b={_colId:c.parentColumn,
name:this._colById(c.parentColumn).name,children:0};b.children++}else b&&a.push(b),e++,b=null}delete this.grid.header.groups;this.grid.headerGroups=a;this.grid.header.refresh();var g=this;h(".gridxGroupHeader",this.grid.headerNode).forEach(function(a){var b=a.getAttribute("groupid").split("-").pop(),b=g._colById(b).parentColumn;a.setAttribute("data-map-column-id",b);var c=l.create("div",{innerHTML:'\x3cspan class\x3d"gridxColumnCollapseNodeIcon"\x3e\x3c/span\x3e',className:"gridxColumnCollapseNode"});
c.onclick=function(){g.collapse(b)};a.firstChild.insertBefore(c,a.firstChild.firstChild)})},_colById:function(a){return this.grid._columnsById[a]||g.filter(this._cols,function(d){return d.id==a})[0]},_focusById:function(a){(a=this._headerCellByColumnId(a))&&this.grid.header._focusNode(a)}})});
//@ sourceMappingURL=ExpandableColumn.js.map